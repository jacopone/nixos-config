# NixOS Configuration

## Project Overview

This repository contains a NixOS configuration managed with Nix Flakes. It defines the complete configuration for a NixOS system, including system-level packages, services, and user-specific settings managed by `home-manager`.

The system is configured with:
*   **Hostname:** `nixos`
*   **Desktop Environment:** GNOME
*   **User:** `guyfawkes`

## Building and Running

To apply this configuration to your NixOS system, you can use the following commands from the root of this repository:

*   **Build and switch to the new configuration:**
    ```bash
    sudo nixos-rebuild switch --flake .
    ```

*   **Test the new configuration without switching:**
    ```bash
    nixos-rebuild test --flake .
    ```

*   **Running a command in the development environment:**
    ```bash
    nix develop . -c -- <command>
    ```

## Key Files

*   `flake.nix`: The entry point for the Nix Flake. It defines the dependencies (`nixpkgs`, `home-manager`) and the overall structure of the configuration.
*   `configuration.nix`: The main system-wide configuration file. It imports `hardware-configuration.nix` and defines system settings like the bootloader, networking, enabled services, and system-level packages.
*   `home.nix`: The `home-manager` configuration for the `guyfawkes` user. This file is used to manage user-specific packages, dotfiles, and program settings.
*   `hardware-configuration.nix`: This file is generated by the NixOS installation and contains hardware-specific settings for the machine.

## Development Conventions

*   **Flake-based:** The entire configuration is managed as a Nix Flake, making it self-contained and reproducible.
*   **Separation of Concerns:**
    *   System-wide settings are in `configuration.nix`.
    *   User-specific settings are in `home.nix`.
*   **Packages:**
    *   System-level packages are listed in the `environment.systemPackages` attribute in `configuration.nix`.
    *   User-specific packages are listed in the `home.packages` attribute in `home.nix`.

## Automated Rebuild Script

This repository includes a script to automate the process of updating, building, and cleaning up the system.

*   **Automated update and rebuild:**
    ```bash
    ./rebuild-nixos
    ```

This script performs the following actions:
1.  Checks for a clean Git working directory.
2.  Updates the flake inputs using `nix flake update`.
3.  Commits the updated `flake.lock` file.
4.  Rebuilds the system using `sudo nixos-rebuild switch --flake .`.
5.  Cleans up old system generations, keeping the 3 most recent ones.