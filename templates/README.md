# 🏗️ NixOS Development Templates

**Enterprise-grade project templates with integrated quality gates and AI development support**

## 📋 **Available Templates**

### **🤖 AI Quality DevEnv Template**

**Location**: `templates/ai-quality-devenv/`

**Description**: Complete enterprise-grade development environment template with comprehensive quality gates designed for AI-assisted coding and modern development workflows.

#### **🎯 Features**

- **🔒 Enterprise Quality Gates**: Gitleaks, Semgrep, Lizard complexity analysis, JSCPD clone detection
- **🤖 Cursor AI Integration**: Complete `.cursor/rules/` system with MDC format for AI behavior configuration
- **🚀 Modern Stack**: Node.js 20, Python 3.13 with uv, DevEnv for environment management
- **🔧 Pure DevEnv Architecture**: Single `devenv.nix` file with automatic Nix flake generation
- **⚡ System Integration**: Uses system-wide quality tools for consistency and performance

#### **🛠️ Technology Stack**

- **Frontend**: JavaScript/TypeScript with Node.js 20, ESLint, Prettier
- **Backend**: Python 3.13 with uv package manager, Black, Ruff
- **Quality**: System-wide lizard, jscpd, radon; project-level gitleaks, semgrep
- **Git Hooks**: Automated quality gate enforcement via pre-commit hooks
- **AI Development**: Cursor AI rules synchronized with quality standards

#### **📁 Template Structure**

```
ai-quality-devenv/
├── 📄 devenv.nix              # Complete development environment configuration
├── 📄 .envrc                  # Direnv integration
├── 📄 README.md               # Complete usage documentation
├── 📂 .cursor/                # Cursor AI configuration
│   └── rules/                 # AI behavior rules (MDC format)
│       ├── index.mdc          # Core development rules
│       ├── security.mdc       # Security-focused patterns
│       └── testing.mdc        # Testing and QA rules
├── 📄 .cursorignore          # AI context optimization
└── 📂 scripts/               # Quality and setup scripts
    ├── quality-check          # Comprehensive quality analysis
    ├── setup-git-hooks       # Git hooks installation
    └── setup-cursor          # Cursor AI setup

# Auto-generated by DevEnv (do not edit manually):
├── 📄 .devenv.flake.nix      # Auto-generated Nix flake for compatibility
```

#### **🚀 Quick Start**

```bash
# 1. Copy template to your new project
cp -r ~/nixos-config/templates/ai-quality-devenv/* /path/to/new-project/
cd /path/to/new-project

# 2. Initialize project environment
direnv allow          # Automatic activation
# OR
devenv shell          # Manual activation

# 3. Interactive AI tools setup (NEW - RECOMMENDED!)
init-ai-tools         # Choose Claude Code, Cursor AI, or both

# 4. Setup quality gates
setup-git-hooks       # Install pre-commit hooks
quality-report        # Verify all systems

# 5. Start development
npm init              # Initialize package.json
uv init               # Initialize Python project
```

#### **🎯 Quality Standards**

| **Quality Metric** | **Threshold** | **Tool** | **Enforcement** |
|-------------------|---------------|----------|-----------------|
| **Cyclomatic Complexity** | CCN < 10 | Lizard (system-wide) | Pre-commit hook |
| **Code Duplication** | < 5% | JSCPD (system-wide) | Pre-commit hook |
| **Security Patterns** | Zero violations | Semgrep | Pre-commit hook |
| **Secret Detection** | Zero secrets | Gitleaks | Pre-commit hook |
| **Code Formatting** | 100% compliance | Prettier, ESLint, Black, Ruff | Pre-commit hook |
| **Commit Format** | Conventional Commits | Commitizen | commit-msg hook |

#### **🤖 AI Development Integration**

The template includes comprehensive **dual AI system integration** (Cursor AI + Claude Code) with enterprise-grade quality gates:

**Cursor AI:**
- **MDC Rule System**: Modern `.cursor/rules/*.mdc` files for AI behavior configuration
- **YOLO Mode**: Advanced AI capabilities with build/test execution
- **Agent Mode**: Enhanced shortcuts for complex refactoring tasks

**Claude Code (NEW - October 2025):**
- **Project-Level CLAUDE.md**: Comprehensive 6KB instruction file with quality gate awareness
- **MCP Serena Integration**: Optimized symbolic code operations for token efficiency
- **Quality Hooks**: Pre/Post tool use reminders for complexity, duplication, security
- **DevEnv Context**: Full understanding of Node.js 20, Python 3.13, and quality tools

**Shared Features:**
- **Quality Synchronization**: Both AI systems enforce identical quality thresholds
- **Project Context**: AI understands technology stack, patterns, and constraints
- **Security Integration**: AI prevents credential exposure and follows security best practices
- **Testing Patterns**: AI generates comprehensive tests with proper coverage

#### **🔧 Customization**

**Adding Packages**:
```nix
# In devenv.nix
packages = with pkgs; [
  # Existing packages...
  your-additional-package
];
```

**Adding Services**:
```nix
# In devenv.nix
services = {
  postgres.enable = true;
  redis.enable = true;
};
```

**Customizing AI Rules**:
```bash
# Edit project-specific AI behavior
nano .cursor/rules/index.mdc

# Add domain-specific rules
touch .cursor/rules/analytics.mdc
touch .cursor/rules/database.mdc
```

#### **📊 Quality Reporting**

```bash
# View active quality gates
quality-report

# Run comprehensive analysis
quality-check

# Test all git hooks
devenv test

# Verify system tools
lizard --version && jscpd --version && radon --version
```

## 🔄 **Template Usage Workflow**

### **1. Project Initialization**
```bash
# Navigate to your projects directory
cd ~/projects

# Copy template
cp -r ~/nixos-config/templates/ai-quality-devenv ./my-new-project
cd my-new-project

# Initialize environment
direnv allow
```

### **2. Setup Development Environment**
```bash
# Interactive AI tools setup (RECOMMENDED)
init-ai-tools         # Choose Claude Code, Cursor AI, or both

# Setup quality gates
setup-git-hooks

# Initialize project files
npm init              # For JavaScript/TypeScript projects
uv init               # For Python projects
```

### **3. Verify Setup**
```bash
# Check all systems
quality-report

# Test quality gates
devenv test

# Start development
npm run dev           # Or your development command
```

## 🧠 **AI-Enhanced Development**

### **Dual AI System Support**

The template provides **state-of-the-art AI development integration** for both major AI coding assistants:

**Universal Features:**
- **🎯 Context-Aware**: AI understands project structure, tech stack, and quality requirements
- **🔒 Security-First**: AI rules prevent credential exposure and enforce security patterns
- **🧪 Testing-Focused**: AI generates comprehensive tests with proper coverage patterns
- **📏 Quality-Enforced**: AI respects complexity (CCN < 10), duplication (< 5%), and formatting standards

### **Interactive Setup (NEW - October 2025)**

```bash
# One command to rule them all
init-ai-tools

# Interactive prompt appears:
# 🤖 AI Development Tools Setup
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
#
# Select AI tool(s) to configure:
#   [ ] Claude Code - Token-efficient with MCP Serena
#   [ ] Cursor AI - YOLO mode with Agent shortcuts
#   [ ] Skip - Manual setup later
#
# Use Space to select, Enter to confirm
```

### **Cursor AI Usage**

```bash
# Setup
init-ai-tools           # Select "Cursor AI" in prompt
# OR
setup-cursor            # Direct setup

# Agent Mode for complex tasks
# Ctrl+I in Cursor → "Implement user authentication with proper testing"

# Background mode for continuous suggestions
# Ctrl+E in Cursor → Continuous AI assistance

# Rules in .cursor/rules/*.mdc automatically enforce quality gates
```

### **Claude Code Usage (October 2025)**

```bash
# Setup
init-ai-tools           # Select "Claude Code" in prompt
# OR
setup-claude            # Direct setup

# Quality-aware development
claude-code .           # Start Claude Code session

# Available optimizations:
# - MCP Serena server for symbolic code operations (token efficient)
# - .claude/CLAUDE.md with comprehensive quality gate instructions
# - Pre/Post hooks remind about quality thresholds on Write/Edit
# - Enterprise settings with full MCP server integration
```

**Claude Code Advantages:**
- **Token Efficiency**: MCP Serena tools for surgical code operations
- **Comprehensive Instructions**: 6KB CLAUDE.md with quality compliance strategies
- **DevEnv Aware**: Knows about Node 20, Python 3.13, uv, and all quality tools
- **Quality Hooks**: Automatic reminders when modifying code

## 🔧 **Integration with NixOS System**

### **System-Level Tools**

The template leverages **system-wide quality tools** from your NixOS configuration:

```nix
# Available system-wide (modules/core/packages.nix)
lizard             # Code complexity analysis
python312Packages.radon # Python metrics
nodePackages.jscpd    # Clone detection
```

### **Benefits**

- **✅ Consistency**: Same tool versions across all projects
- **✅ Performance**: No package compilation overhead in DevEnv
- **✅ AI Integration**: Tools always available for AI agents
- **✅ Universal Access**: Works across all development environments

## 📚 **Documentation & Support**

- **Template README**: Complete setup and usage guide in each template
- **Quality Integration**: Comprehensive documentation in `docs/CURSOR_AI_QUALITY_INTEGRATION.md`
- **NixOS Config**: Main system documentation in root `README.md`
- **AI Development**: Cursor AI setup guide in project documentation

## 🤝 **Contributing to Templates**

### **Adding New Templates**

1. Create new directory under `templates/`
2. Include complete `README.md` with usage instructions
3. Add quality gates and AI integration where applicable
4. Update this documentation
5. Test template with real projects

### **Improving Existing Templates**

1. Follow existing patterns and conventions
2. Maintain backward compatibility
3. Update documentation
4. Test changes thoroughly

---

**Built for modern development teams that demand excellence in code quality, security, and AI-assisted development.**